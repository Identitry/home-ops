# Deploy Cozystack.
---
apiVersion: v1
kind: Namespace
metadata:
  name: cozy-system
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cozystack
  namespace: cozy-system
data:
  bundle-name: "paas-full"
  bundle-enable: external-secrets-operator
  ipv4-pod-cidr: "10.244.0.0/16"
  ipv4-pod-gateway: "10.244.0.1"
  ipv4-svc-cidr: "10.96.0.0/16"
  ipv4-join-cidr: "100.64.0.0/16"
  root-host: myk8s.se
  api-server-endpoint: https://192.168.222.20:6443
---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: cozystack
  namespace: flux-system
spec:
  interval: 10m
  path: ./clusters/k8s/cozystack
  prune: true
  sourceRef:
    kind: GitRepository
    name: home-ops
  dependsOn: []
  patches:
    - target:
        kind: Kustomization
      patch: |
        - op: replace
          path: /spec/sourceRef/url
          value: https://github.com/cozystack/cozystack/releases/download/v0.30.3/cozystack-installer.yaml
